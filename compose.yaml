# ============================================
# Counter-Strike: Source Server - Docker Compose
# ============================================
# For use with Dockge - pulls pre-built image from registry
#
# VOLUMES: Choose your mounting strategy below.
# Option A: Mount entire folders (simpler)
# Option B: Mount specific subfolders (granular control)

services:
  css-server:
    image: ghcr.io/quiomatic/css-server:latest
    container_name: css-server
    restart: unless-stopped
    network_mode: host

    environment:
      # === SERVER IDENTITY ===
      CSS_HOSTNAME: ${CSS_HOSTNAME:-Counter-Strike Source Server}
      CSS_PASSWORD: ${CSS_PASSWORD:-}
      RCON_PASSWORD: ${RCON_PASSWORD:-}
      CSS_CONTACT: ${CSS_CONTACT:-}
      CSS_REGION: ${CSS_REGION:-255}

      # === NETWORK ===
      CSS_PORT: ${CSS_PORT:-27015}
      CSS_MAXPLAYERS: ${CSS_MAXPLAYERS:-24}
      CSS_TICKRATE: ${CSS_TICKRATE:-66}

      # === GAMEPLAY ===
      CSS_MAP: ${CSS_MAP:-de_dust2}
      CSS_FRIENDLYFIRE: ${CSS_FRIENDLYFIRE:-0}
      CSS_ALLTALK: ${CSS_ALLTALK:-0}
      CSS_TIMELIMIT: ${CSS_TIMELIMIT:-30}
      CSS_ROUNDTIME: ${CSS_ROUNDTIME:-2.5}
      CSS_FREEZETIME: ${CSS_FREEZETIME:-6}
      CSS_BUYTIME: ${CSS_BUYTIME:-90}
      CSS_STARTMONEY: ${CSS_STARTMONEY:-800}
      CSS_C4TIMER: ${CSS_C4TIMER:-45}
      CSS_MAXROUNDS: ${CSS_MAXROUNDS:-0}
      CSS_WINLIMIT: ${CSS_WINLIMIT:-0}
      CSS_GRAVITY: ${CSS_GRAVITY:-800}
      CSS_FALLDAMAGE: ${CSS_FALLDAMAGE:-1}

      # === BOTS ===
      CSS_BOT_QUOTA: ${CSS_BOT_QUOTA:-0}
      CSS_BOT_QUOTA_MODE: ${CSS_BOT_QUOTA_MODE:-fill}
      CSS_BOT_DIFFICULTY: ${CSS_BOT_DIFFICULTY:-2}
      CSS_BOT_CHATTER: ${CSS_BOT_CHATTER:-minimal}
      CSS_BOT_JOIN_AFTER_PLAYER: ${CSS_BOT_JOIN_AFTER_PLAYER:-1}
      CSS_BOT_AUTO_VACATE: ${CSS_BOT_AUTO_VACATE:-1}
      CSS_BOT_PREFIX: ${CSS_BOT_PREFIX:-[BOT]}

      # === SECURITY ===
      CSS_PURE: ${CSS_PURE:-2}
      CSS_CHEATS: ${CSS_CHEATS:-0}
      CSS_ALLOWUPLOAD: ${CSS_ALLOWUPLOAD:-0}
      CSS_ALLOWDOWNLOAD: ${CSS_ALLOWDOWNLOAD:-1}

      # === FAST DOWNLOAD ===
      CSS_DOWNLOADURL: ${CSS_DOWNLOADURL:-}
      CSS_MAXFILESIZE: ${CSS_MAXFILESIZE:-64}

      # === LOGGING ===
      CSS_LOG: ${CSS_LOG:-on}
      CSS_LOGBANS: ${CSS_LOGBANS:-1}
      CSS_LOGDETAIL: ${CSS_LOGDETAIL:-3}

      # === STEAM ===
      STEAM_GSLT: ${STEAM_GSLT:-}

    volumes:
      # =============================================
      # OPTION A: SIMPLE - Mount entire folders
      # =============================================
      # Just uncomment what you need. Easier for installing mods.

      # All configs (server.cfg, mapcycle.txt, etc.)
      - ./cfg:/home/steam/css/cstrike/cfg

      # All addons (MetaMod + SourceMod + any other mods)
      - ./addons:/home/steam/css/cstrike/addons

      # Custom maps
      - ./maps:/home/steam/css/cstrike/maps

      # Custom sounds
      - ./sound:/home/steam/css/cstrike/sound

      # Custom materials/textures
      - ./materials:/home/steam/css/cstrike/materials

      # Custom models
      - ./models:/home/steam/css/cstrike/models

      # Server logs
      - ./logs:/home/steam/css/cstrike/logs

      # =============================================
      # OPTION B: GRANULAR - Mount specific subfolders
      # =============================================
      # Comment out Option A above and uncomment these for more control.
      # Useful if you only want to customize specific parts.

      # # Configs
      # - ./cfg:/home/steam/css/cstrike/cfg

      # # SourceMod only (keeps MetaMod from image)
      # - ./addons/sourcemod/plugins:/home/steam/css/cstrike/addons/sourcemod/plugins
      # - ./addons/sourcemod/configs:/home/steam/css/cstrike/addons/sourcemod/configs
      # - ./addons/sourcemod/data:/home/steam/css/cstrike/addons/sourcemod/data
      # - ./addons/sourcemod/logs:/home/steam/css/cstrike/addons/sourcemod/logs

      # # Content
      # - ./maps:/home/steam/css/cstrike/maps
      # - ./sound:/home/steam/css/cstrike/sound

    healthcheck:
      test: ["CMD-SHELL", "pgrep -f srcds_linux || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
